RewriteEngine on

# Proxy requests to /**/*.php
RewriteCond %{LA-U:REQUEST_FILENAME} -f
RewriteRule ^/(.*\.php)$ fcgi://#{PHP_FPM_LISTEN}${HOME}/htdocs/$1 [P,L]

# Proxy requests for folders, if an index.html file doesn't exist,
#  to /**/index.php
RewriteCond %{LA-U:REQUEST_FILENAME} -d
RewriteCond %{LA-U:REQUEST_FILENAME}index.html !-f
RewriteCond %{LA-U:REQUEST_FILENAME}index.php -f
RewriteRule ^/(.*)$ fcgi://#{PHP_FPM_LISTEN}${HOME}/htdocs/$1index.php [P,L]
